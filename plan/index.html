<!DOCTYPE html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thndr — التقرير اليومي</title>
<style>
:root{--bg:#0b0b0f;--card:#14141b;--soft:#0f1016;--border:#23242c;--txt:#f3f4f6;--muted:#a1a1aa;--acc:#0ea5e9;--good:#22c55e;--bad:#ef4444}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--txt);font-family:"Cairo",Tahoma,Arial}
.container{max-width:1100px;margin:22px auto;padding:0 16px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.title{font-size:24px;font-weight:800}.chip{padding:6px 12px;border-radius:12px;background:#14141b;border:1px solid var(--border);color:var(--muted)}
.pills{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}.pill{background:#1f2937;border:1px solid #2b2f3a;color:#e5e7eb;border-radius:999px;padding:8px 12px;cursor:pointer}
.card{background:#14141b;border:1px solid var(--border);border-radius:16px;padding:16px;margin:12px 0}
.grid{display:grid;gap:12px}.two{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.stat{display:flex;justify-content:space-between;background:#0f1016;border:1px solid var(--border);border-radius:14px;padding:12px}
.table{width:100%;border-collapse:collapse;background:#0f1016;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:right;font-size:14px}
.table th{background:#101118;color:#cbd5e1}.pos-good{color:var(--good)}.pos-bad{color:var(--bad)}
.watch{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.wcard{background:#0f1016;border:1px solid var(--border);border-radius:14px;padding:14px}
.btn{background:var(--acc);color:#fff;border:0;border-radius:12px;padding:9px 12px;text-decoration:none}
.small{color:var(--muted);font-size:12px}
</style>
</head><body><div class="container">
  <div class="header">
    <div class="title">التقرير اليومي — محفظة ثاندر</div>
    <div id="date" class="chip">—</div>
  </div>

  <div class="pills">
    <a class="pill" href="../">الرجوع للـ Dashboard</a>
    <button class="pill" onclick="goto('HOME')">الملخص</button>
    <button class="pill" onclick="goto('WATCH')">قائمة المراقبة</button>
    <button class="pill" onclick="goto('CALC')">حاسبة</button>
  </div>

  <!-- ملخص -->
  <section id="HOME" class="card">
    <div class="grid two" id="stats"></div>
    <div class="card" style="padding:0;margin-top:10px">
      <table class="table" id="pos"><thead>
        <tr><th>السهم</th><th>الوحدات</th><th>متوسط</th><th>آخر</th><th>القيمة</th><th>الربح/الخسارة</th></tr>
      </thead><tbody></tbody></table>
    </div>
  </section>

  <!-- مراقبة -->
  <section id="WATCH" class="card" style="display:none">
    <div class="watch" id="watch"></div>
  </section>

  <!-- الحاسبة -->
  <section id="CALC" class="card" style="display:none">
    <div class="grid two">
      <div>
        <label class="small">سعر الدخول</label><input id="e" type="number" step="0.01" value="10" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff">
        <label class="small" style="margin-top:8px;display:block">رأس المال (ج.م)</label><input id="cap" type="number" step="100" value="5000" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff">
        <label class="small" style="margin-top:8px;display:block">نسبة المخاطرة %</label><input id="risk" type="number" step="0.5" value="1.5" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff">
        <label class="small" style="margin-top:8px;display:block">وقف الخسارة</label><input id="s" type="number" step="0.01" value="9.2" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff">
        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="flex:1"><label class="small">هدف ١</label><input id="t1" type="number" step="0.01" value="11.2" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff"></div>
          <div style="flex:1"><label class="small">هدف ٢</label><input id="t2" type="number" step="0.01" value="12" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff"></div>
        </div>
        <label class="small" style="margin-top:8px;display:block">عمولة إجمالي % (بيع+شراء)</label><input id="c" type="number" step="0.01" value="0.15" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff">
        <label class="small" style="margin-top:8px;display:block">رسوم ثابتة (لكل جانب)</label><input id="f" type="number" step="1" value="0" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f3a;background:#0b0c12;color:#fff">
        <div style="margin-top:10px">
          <button class="btn" onclick="calc()">احسب</button>
          <a id="csv" class="btn" style="background:#475569" href="#">تصدير CSV</a>
        </div>
        <div id="out" style="margin-top:10px" class="small"></div>
      </div>
      <div class="small">يمكنك إرسال أي سهم من صفحة خطة الإيداع للحاسبة تلقائيًا.</div>
    </div>
  </section>
</div>
<script>
const fmt=(n,d=2)=>new Intl.NumberFormat('ar-EG',{maximumFractionDigits:d}).format(n);
const pct=n=>((n>=0?'+':'')+n.toFixed(2)+'%');
function goto(id){['HOME','WATCH','CALC'].forEach(x=>document.getElementById(x).style.display=x===id?'block':'none');location.hash=id}
async function load(){
  const [p,w]=await Promise.all([
    fetch('../data/portfolio.json?_='+Date.now()).then(r=>r.json()),
    fetch('../data/watchlist.json?_='+Date.now()).then(r=>r.json())
  ]);
  document.getElementById('date').textContent=new Date(p.as_of).toLocaleDateString('ar-EG',{day:'numeric',month:'long',year:'numeric'});
  document.getElementById('stats').innerHTML=`
    <div class="stat"><span>قيمة استثماري</span><b>${fmt(p.portfolio_value)}</b></div>
    <div class="stat"><span>تغير اليوم</span><b class="${p.day_change>=0?'pos-good':'pos-bad'}">${fmt(p.day_change)} (${pct(p.day_change_pct)})</b></div>`;
  document.querySelector('#pos tbody').innerHTML=p.positions.map(x=>`
    <tr><td><b>${x.ticker}</b> — <span class="small">${x.name}</span></td>
    <td>${fmt(x.units,0)}</td><td>${fmt(x.avg_price)}</td><td>${fmt(x.last)}</td>
    <td>${fmt(x.market_value)}</td><td class="${x.pnl>=0?'pos-good':'pos-bad'}">${fmt(x.pnl)} (${pct(x.pnl_pct)})</td></tr>`).join('');
  document.getElementById('watch').innerHTML=w.map(d=>`
    <div class="wcard">
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:6px">
        <div style="background:#1f2937;border:1px solid #2b2f3a;border-radius:999px;padding:2px 10px;font-weight:800">${d.tkr}</div>
        <div style="font-weight:700">${d.name}</div>
      </div>
      <div class="small">التصنيف: <b>${d.bias||'-'}</b></div>
      <div class="small">منطقة الدخول: <b>${d.zone||'-'}</b></div>
      <div class="small">إيقاف: <b>${d.stop??'-'}</b> — أهداف: <b>${d.t1??'-'}/${d.t2??'-'}</b></div>
      <div class="small" style="margin-top:6px">${d.thesis||''}</div>
      <div style="margin-top:10px"><a class="btn" target="_blank" href="${d.link||'#'}">فتح على مباشر</a></div>
    </div>`).join('');
}
function calc(){
  const e=parseFloat(e_.value||e.value),cap=parseFloat(cap_.value||cap.value||5000),
    risk=parseFloat(risk_.value||risk.value)/100,s=parseFloat(s_.value||s.value),
    c=parseFloat(c_.value||c.value||0)/100,f=parseFloat(f_.value||f.value||0);
  if([e,cap,risk,s].some(x=>isNaN(x)||x<=0)) return alert('تحقق من القيم');
  const t1v=parseFloat(t1_.value||t1.value), t2v=parseFloat(t2_.value||t2.value);
  const riskAmt=cap*risk, qty=Math.floor(riskAmt/Math.max(e-s,0.0001)), buy=qty*e,
        sell1=qty*t1v, sell2=qty*t2v, feesBuy=buy*(c/2)+f, fees1=sell1*(c/2)+f, fees2=sell2*(c/2)+f,
        net1=(sell1-buy)-(feesBuy+fees1), net2=(sell2-buy)-(feesBuy+fees2),
        rr1=(t1v-e)/(e-s), rr2=(t2v-e)/(e-s);
  out.innerHTML=`الكمية: <b>${fmt(qty,0)}</b> — تكلفة الشراء: <b>${fmt(buy)}</b> — صافي الربح: هدف١ <b>${fmt(net1)}</b> | هدف٢ <b>${fmt(net2)}</b> — R:R ≈ ${rr1.toFixed(2)} / ${rr2.toFixed(2)}`;
  const csv=[['Entry',e],['Capital',cap],['Risk %',risk*100],['Stop',s],['Qty',qty],['Target1',t1v],['Net1',net1],['Target2',t2v],['Net2',net2]].map(r=>r.join(',')).join('\n');
  csv_.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);csv_.download='calc.csv'; document.getElementById('csv').href=csv_.href;document.getElementById('csv').download='calc.csv';
}
const e_=document.getElementById('e'),cap_=document.getElementById('cap'),risk_=document.getElementById('risk'),s_=document.getElementById('s'),t1_=document.getElementById('t1'),t2_=document.getElementById('t2'),c_=document.getElementById('c'),f_=document.getElementById('f');
const csv_=document.createElement('a');load();goto(location.hash.replace('#','')||'HOME');
</script>
</body></html>
