<!DOCTYPE html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thndr â€” Dashboard</title>
<style>
:root{--bg:#0b0b0f;--card:#14141b;--soft:#0f1016;--border:#23242c;--txt:#f3f4f6;--muted:#a1a1aa;--acc:#0ea5e9;--good:#22c55e;--bad:#ef4444}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--txt);font-family:"Cairo",Tahoma,Arial,sans-serif}
.container{max-width:1200px;margin:22px auto;padding:0 16px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.title{font-size:26px;font-weight:800}.chip{background:#14141b;border:1px solid var(--border);color:var(--muted);padding:6px 12px;border-radius:12px}
.grid{display:grid;gap:12px}.two{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.card{background:#14141b;border:1px solid var(--border);border-radius:16px;padding:16px}
.stat{display:flex;justify-content:space-between;align-items:center;background:#0f1016;border:1px solid var(--border);border-radius:14px;padding:12px}
.stat b{font-size:18px}.small{color:var(--muted);font-size:12px}
.btn{display:inline-block;background:var(--acc);color:#fff;text-decoration:none;border:0;border-radius:12px;padding:10px 14px}
.linkrow{display:flex;gap:8px;flex-wrap:wrap}
.table{width:100%;border-collapse:collapse;background:#0f1016;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:right;font-size:14px}
.table th{background:#101118;color:#cbd5e1}.pos-good{color:var(--good)}.pos-bad{color:var(--bad)}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://s3.tradingview.com/tv.js"></script>
</head><body><div class="container">
  <div class="header"><div class="title">Ù„ÙˆØ­Ø© Ø«Ø§Ù†Ø¯Ø± â€” Dashboard</div><div id="date" class="chip">â€”</div></div>

  <div class="grid two">
    <div class="card">
      <div class="grid two" id="stats"></div>
      <!-- ğŸŸ© Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± -->
<div id="marketBar" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px">
  <div class="stat" style="background:#0f1016;border-radius:8px;padding:6px 10px;flex:1;text-align:center;">
    <b>EGX30:</b> <span id="egx30_val" class="pos">+0.85%</span>
  </div>
  <div class="stat" style="background:#0f1016;border-radius:8px;padding:6px 10px;flex:1;text-align:center;">
    <b>EGX70:</b> <span id="egx70_val" class="neg">-0.22%</span>
  </div>
  <div class="stat" style="background:#0f1016;border-radius:8px;padding:6px 10px;flex:1;text-align:center;">
    <b>Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±:</b> <span id="usd_val">48.20 Ø¬</span>
  </div>
</div>
      <div style="margin-top:10px" class="linkrow">
        <a class="btn" href="report/">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</a>
        <a class="btn" href="plan/">Ø®Ø·Ø© Ø¥ÙŠØ¯Ø§Ø¹ 24</a>
        <a class="btn" href="report/#CALC">Ø­Ø§Ø³Ø¨Ø© ØªØ¯Ø§ÙˆÙ„</a>
      </div>
    </div>
    <div class="card">
      <div style="font-weight:700;margin-bottom:6px">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
      <canvas id="alloc" height="280"></canvas>
      <div id="allocLegend" class="small" style="margin-top:6px"></div>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:700;margin-bottom:6px">EGX30 â€” Ù…Ø¨Ø§Ø´Ø±</div>
    <div id="egx" style="height:380px"></div>
    <div class="small">Ø¥Ù† Ù„Ù… ÙŠØ¸Ù‡Ø± Ø§Ù„Ø±Ø³Ù… Ø¬Ø±Ù‘Ø¨ Ø´Ø¨ÙƒØ© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§ÙØªØ­Ù‡ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¨Ø§Ø´Ø±Ø©.</div>
  </div>

  <div class="card" style="padding:0;margin-top:12px">
    <table class="table" id="pos">
      <thead><tr><th>Ø§Ù„Ø³Ù‡Ù…</th><th>Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th><th>Ù…ØªÙˆØ³Ø·</th><th>Ø¢Ø®Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<script>
const fmt=(n,d=2)=>new Intl.NumberFormat('ar-EG',{maximumFractionDigits:d}).format(n);
const pct=n=>((n>=0?'+':'')+n.toFixed(2)+'%');
async function boot(){
  const p=await (await fetch('data/portfolio.json?_='+Date.now())).json();
  document.getElementById('date').textContent=new Date(p.as_of).toLocaleDateString('ar-EG',{day:'numeric',month:'long',year:'numeric'});
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  document.getElementById('stats').innerHTML=`
    <div class="stat"><span>Ù‚ÙŠÙ…Ø© Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ</span><b>${fmt(p.portfolio_value)}</b></div>
    <div class="stat"><span>ØªØºÙŠØ± Ø§Ù„ÙŠÙˆÙ…</span><b class="${p.day_change>=0?'pos-good':'pos-bad'}">${fmt(p.day_change)} (${pct(p.day_change_pct)})</b></div>`;
  // Ø¬Ø¯ÙˆÙ„
  const tb=document.querySelector('#pos tbody');
  tb.innerHTML=p.positions.map(x=>`
    <tr><td><b>${x.ticker}</b> â€” <span class="small">${x.name}</span></td>
    <td>${fmt(x.units,0)}</td><td>${fmt(x.avg_price)}</td><td>${fmt(x.last)}</td>
    <td>${fmt(x.market_value)}</td>
    <td class="${x.pnl>=0?'pos-good':'pos-bad'}">${fmt(x.pnl)} (${pct(x.pnl_pct)})</td></tr>`).join('');
  // ØªÙˆØ²ÙŠØ¹
  const ctx=document.getElementById('alloc').getContext('2d');
  const labels=p.positions.map(x=>x.ticker), data=p.positions.map(x=>x.market_value);
  const total=data.reduce((a,b)=>a+b,0), per=data.map(v=>v/total*100);
  new Chart(ctx,{type:'doughnut',data:{labels,datasets:[{data,borderWidth:0}]},options:{plugins:{legend:{display:false}},cutout:'60%'}});
  document.getElementById('allocLegend').innerHTML=labels.map((l,i)=>`${l}: ${fmt(per[i])}%`).join(' â€¢ ');
  // EGX30
  try{ new TradingView.widget({width:"100%",height:380,symbol:"EGX:EGX30",interval:"60",timezone:"Africa/Cairo",theme:"dark",style:"1",locale:"ar",container_id:"egx"}); }catch(e){}
}
boot();
  <script>
/* ... ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ... */

let REFRESH_MS = 5 * 60 * 1000; // ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚

async function refreshOnce(){
  // Ø£Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù… Ù…Ù† Ø§Ù„ØµÙØ±
  try{
    const [p,market] = await Promise.all([
      fetch('data/portfolio.json?_=' + Date.now()).then(r=>r.json()),
      fetch('data/market.json?_=' + Date.now()).then(r=>r.json())
    ]);
    // Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ
    document.getElementById('tb_val').textContent = new Intl.NumberFormat('ar-EG').format(p.portfolio_value);
    document.getElementById('tb_day').innerHTML =
      `<span class="${p.day_change>=0?'pos':'neg'}">${new Intl.NumberFormat('ar-EG').format(p.day_change)} (${(p.day_change_pct>=0?'+':'') + p.day_change_pct.toFixed(2)}%)</span>`;
    const egx30 = market?.egx30?.chg_pct ?? 0, egx70 = market?.egx70?.chg_pct ?? 0, usd = market?.usd_egp ?? 0;
    document.getElementById('tb_mkt').innerHTML =
      `EGX30 <span class="${egx30>=0?'pos':'neg'}">${(egx30>=0?'+':'')+egx30.toFixed(2)}%</span> â€¢ ` +
      `EGX70 <span class="${egx70>=0?'pos':'neg'}">${(egx70>=0?'+':'')+egx70.toFixed(2)}%</span> â€¢ $ ${new Intl.NumberFormat('ar-EG').format(usd)}`;
  }catch(e){}
}

function enableAutoRefresh(){
  refreshOnce();                     // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ
  setInterval(refreshOnce, REFRESH_MS);
}

boot();
enableAutoRefresh();
</script>
</script>
  <script>
async function updateMarket(){
  try{
    const r = await fetch('data/market.json?_=' + Date.now());
    const j = await r.json();
    const set = (id, val, pos)=> {
      const el=document.getElementById(id);
      if(!el) return;
      el.textContent = val;
      el.className = pos>=0?'pos':'neg';
    };
    set('egx30_val', (j.egx30.chg_pct>=0?'+':'')+j.egx30.chg_pct.toFixed(2)+'%', j.egx30.chg_pct);
    set('egx70_val', (j.egx70.chg_pct>=0?'+':'')+j.egx70.chg_pct.toFixed(2)+'%', j.egx70.chg_pct);
    document.getElementById('usd_val').textContent = j.usd_egp.toFixed(2)+' Ø¬';
  }catch(e){console.warn('Market data error',e);}
}
updateMarket();
setInterval(updateMarket, 5*60*1000);
</script>
</body></html>
